What is ACTUALLY blocking Yahoo data right now?

Your issue is NOT data_provider.py
Your issue is screener.py and precomputed_scans.py hard-requiring Polygon keys
Even though Yahoo is available, the app never reaches Yahoo on those pages because execution exits early when massive_api_key is missing.
________________________________________
1Ô∏è‚É£ MUST CHANGE (Hard Blockers ‚Äì Yahoo Never Runs)
These are non-negotiable if you want Screener / PMCC / Dashboard Opportunities to work with Yahoo.
________________________________________
üö® A. /app/backend/routes/screener.py (CRITICAL)
Problem
This file hard-gates execution on massive_api_key.
if not api_key:
    return {"opportunities": [], "total": 0}
or returns mock data.
‚û°Ô∏è Result:
Yahoo logic is never executed, even though it exists elsewhere.
What developer must do
Remove the API-key gate, not Yahoo logic.
Specifically:
‚Ä¢	Lines 217‚Äì220
‚Ä¢	Lines 545‚Äì546
‚Ä¢	Line 911
Correct behavior
‚Ä¢	Screener routes should:
o	Call data_provider.fetch_stock_quote()
o	Call data_provider.fetch_options_chain()
‚Ä¢	Never check for massive_api_key at route level
üìå This single file is your #1 problem
________________________________________
üö® B. /app/backend/routes/precomputed_scans.py (CRITICAL)
Problem
This file hard-fails with HTTP 400 if Polygon key is missing:
if not service.api_key:
    raise HTTPException(400, "Polygon or Massive API key not configured")
‚û°Ô∏è Result:
‚Ä¢	PMCC scans
‚Ä¢	Any precomputed opportunities
crash completely
What developer must do
One of the following (choose ONE):
Option A (fastest):
‚Ä¢	Temporarily disable precomputed scans
‚Ä¢	Route PMCC ‚Üí live Yahoo scans only
Option B (better):
‚Ä¢	Allow PrecomputedScanService to run without Polygon or Massive
‚Ä¢	Skip Polygon-only enrichments
‚Ä¢	Use Yahoo-backed pricing only
üìå Until this is fixed, PMCC will remain broken.
________________________________________
2Ô∏è‚É£ SHOULD CHANGE (Fake / Blank / Confusing Data)
These won‚Äôt block Yahoo execution, but they corrupt UX.
________________________________________
‚ö†Ô∏è C. /app/backend/routes/stocks.py
Problem
Direct Polygon or Massive calls like:
https://api.polygon.io/v2/aggs/ticker/...
Fallback = mock data.
What to do
‚Ä¢	Replace direct Polygon calls with:
o	data_provider.fetch_stock_quote()
o	data_provider.fetch_historical_prices()
üìå This explains why some stock pages ‚Äúload‚Äù but feel fake.
________________________________________
‚ö†Ô∏è D. /app/backend/routes/options.py
Problem
Direct Polygon option chain calls.
Fallback = mock options.
What to do
‚Ä¢	Route everything through data_provider.fetch_options_chain()
‚Ä¢	Let Yahoo be primary, Polygon or Massive dormant
________________________________________
‚ö†Ô∏è E. Cache Pollution (Important but simple)
Problem
Cached responses are tagged:
"source": "polygon" or ‚Äúmassive‚Äù
What to do
‚Ä¢	Flush:
o	api_cache
o	precomputed_scans
‚Ä¢	Stop hardcoding "data_source": "polygon" or ‚Äúmassive‚Äù
üìå Otherwise Yahoo data may never surface even after fixes.
________________________________________
3Ô∏è‚É£ CAN STAY (Future Polygon Option ‚Äì Do NOT Touch Now)
These are fine to leave for future re-enablement:
‚úÖ data_provider.py
‚Ä¢	Yahoo is already primary
‚Ä¢	Polygon or Massive as fallback is OK
‚úÖ Admin schema:
‚Ä¢	polygon_api_key
‚Ä¢	massive_api_key
‚úÖ SnapshotService, EODIngestionService
Already Yahoo-first
________________________________________
üß† The Real Architecture Mistake (So You Can Explain It)
You can tell your dev this:
‚ÄúWe have two architectures running at once:
‚Ä¢	A new Yahoo-first provider abstraction
‚Ä¢	Old route-level Polygon hard dependencies
The routes are blocking execution before Yahoo is ever called.‚Äù
That framing usually clicks instantly.
________________________________________
Priority Fix Order (Yahoo-only mode):

1. screener.py
   - Remove all checks for massive_api_key or polygon_api_key
   - Do NOT return mock or empty data when key is missing
   - Always execute Yahoo-backed logic via data_provider

2. precomputed_scans.py
   - Remove HTTP 400 when Polygon or Massive  key is missing
   - Either:
     a) Disable precomputed scans temporarily, or
     b) Allow Yahoo-only execution

3. stocks.py & options.py
   - Eliminate direct Polygon or Massive HTTP calls
   - Route through data_provider exclusively

4. Cache cleanup
   - Flush api_cache and precomputed_scans
   - Remove hardcoded "source": "polygon" or ‚Äúmassive‚Äù tags

Goal:
Yahoo Finance must work with ZERO Polygon keys present.
Polygon remains optional, dormant, future-enabled.

